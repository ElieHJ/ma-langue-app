<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polyglot AI Coach - Score & Dynamic</title>
    <style>
        :root { --primary: #4A90E2; --success: #4caf50; --accent: #ff9800; --bg: #f4f7f9; --text: #2c3e50; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 10px; margin: 0; color: var(--text); }
        .container { width: 100%; max-width: 500px; background: white; padding: 20px; border-radius: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); text-align: center; }
        
        .stats-bar { display: flex; justify-content: space-between; align-items: center; background: #f0f7ff; padding: 10px 20px; border-radius: 20px; margin-bottom: 15px; font-weight: bold; color: var(--primary); }
        .stars { color: var(--accent); font-size: 1.2rem; }

        .scenario-box { font-size: 0.8rem; color: #95a5a6; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        
        .chat-area { display: flex; flex-direction: column; gap: 15px; margin: 15px 0; min-height: 180px; justify-content: center; }
        .bubble { padding: 18px; border-radius: 20px; font-size: 1.1rem; line-height: 1.4; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .bubble.bot { background: #f1f1f1; align-self: center; width: 90%; border-bottom-left-radius: 5px; }
        
        .rtl { direction: rtl; font-size: 1.6rem !important; }

        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button { padding: 16px; border: none; border-radius: 15px; cursor: pointer; font-weight: 700; font-size: 14px; transition: 0.2s; }
        .btn-mic { background: var(--success); color: white; grid-column: span 2; font-size: 1.2rem; }
        .btn-next { background: var(--primary); color: white; grid-column: span 2; }
        .btn-listen { background: var(--accent); color: white; }
        .btn-hint { background: #eee; color: #777; }
        
        #status { font-size: 0.8rem; color: #bdc3c7; margin: 15px 0; }
    </style>
</head>
<body>

<div class="container">
    <div class="stats-bar">
        <span>Score: <span id="scoreVal">0</span></span>
        <span class="stars" id="starRating">â­â­â­</span>
    </div>

    <div class="scenario-box" id="scenarioTag">Initialisation...</div>
    
    <select id="langSelect" onchange="resetSession()">
        <option value="en-US">Anglais ğŸ‡ºğŸ‡¸</option>
        <option value="he-IL">HÃ©breu ğŸ‡®ğŸ‡±</option>
        <option value="es-ES">Espagnol ğŸ‡ªğŸ‡¸</option>
    </select>

    <div class="chat-area">
        <div class="bubble bot" id="botBubble">Cliquez sur "Nouveau DÃ©fi" pour gÃ©nÃ©rer une phrase alÃ©atoire.</div>
    </div>

    <div id="status">PrÃªt pour l'entraÃ®nement</div>

    <div class="controls">
        <button class="btn-mic" onclick="testerVoix()">ğŸ¤ RÃ‰PONDRE</button>
        <button class="btn-listen" onclick="rejouer()">ğŸ”Š Ã‰COUTER</button>
        <button class="btn-hint" onclick="voirTraduc()">ğŸ‘ VOIR TRADUCTION</button>
        <button class="btn-next" onclick="genererDefi()">NOUVEAU DÃ‰FI IA â”</button>
    </div>
</div>

<script>
    // SystÃ¨me de gÃ©nÃ©ration de phrases "AlÃ©atoire Dynamique"
    const fragments = {
        "en-US": {
            sujets: ["I want", "Can I have", "Where is", "I am looking for"],
            objets: ["a cold beer", "the train station", "my hotel", "a good restaurant", "the hospital"],
            contexts: ["EN VILLE", "BESOIN", "TOURISME"]
        },
        "he-IL": {
            sujets: ["×× ×™ ×¨×•×¦×”", "××™×¤×” ×”", "××¤×©×¨ ×œ×§×‘×œ", "×× ×™ ××—×¤×©"],
            objets: ["××™×", "×”×©×™×¨×•×ª×™×", "×”×ª×—× ×” ×”××¨×›×–×™×ª", "×§×¤×” ×¢× ×—×œ×‘", "×”××œ×•×Ÿ ×©×œ×™"],
            contexts: ["REPAS", "DIRECTIONS", "BESOIN"]
        }
    };

    let score = localStorage.getItem('polyglotScore') || 0;
    let currentPhrase = "";
    let currentTranslation = "";

    document.getElementById('scoreVal').innerText = score;

    function genererDefi() {
        const lang = document.getElementById('langSelect').value;
        const data = fragments[lang];
        
        if(!data) return alert("Langue bientÃ´t disponible !");

        // Construction alÃ©atoire de la phrase
        const s = data.sujets[Math.floor(Math.random() * data.sujets.length)];
        const o = data.objets[Math.floor(Math.random() * data.objets.length)];
        const ctx = data.contexts[Math.floor(Math.random() * data.contexts.length)];

        currentPhrase = s + " " + o;
        
        // Simuler une traduction (ou utiliser une API)
        document.getElementById('botBubble').innerText = "Traduisez cette phrase...";
        document.getElementById('scenarioTag').innerText = ctx;
        document.getElementById('status').innerText = "Nouveau dÃ©fi gÃ©nÃ©rÃ© !";
        
        // On affiche d'abord la consigne, puis on peut Ã©couter
        rejouer();
    }

    function rejouer() {
        if(!currentPhrase) return;
        const msg = new SpeechSynthesisUtterance(currentPhrase);
        msg.lang = document.getElementById('langSelect').value;
        window.speechSynthesis.speak(msg);
    }

    function voirTraduc() {
        alert("La phrase est : " + currentPhrase);
    }

    function testerVoix() {
        if(!currentPhrase) return;
        const rec = new (window.webkitSpeechRecognition || window.SpeechRecognition)();
        rec.lang = document.getElementById('langSelect').value;
        rec.start();
        
        document.getElementById('status').innerText = "Ã‰coute en cours...";
        
        rec.onresult = (e) => {
            const dit = e.results[0][0].transcript.toLowerCase();
            if(dit.includes(currentPhrase.toLowerCase().replace(/[?.]/g, ""))) {
                score = parseInt(score) + 10;
                localStorage.setItem('polyglotScore', score);
                document.getElementById('scoreVal').innerText = score;
                alert("â­ BRAVO ! +10 points");
                genererDefi();
            } else {
                alert("Presque ! J'ai entendu : " + dit);
            }
        };
    }

    function resetSession() {
        currentPhrase = "";
        document.getElementById('botBubble').innerText = "PrÃªt pour une nouvelle langue ?";
    }
</script>

</body>
</html>
